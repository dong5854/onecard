# ONE CARD — Web Game

## 프로젝트 개요
- **Framework**: Next.js 14 (App Router) + TypeScript
- **UI**: Tailwind CSS, DaisyUI, 픽셀 아트 테마 컴포넌트
- **상태 관리**: `useReducer` 기반 커스텀 훅 (`useOneCardGame`)
- **지원 모드**: 싱글 플레이 (AI 상대 최대 3명)
- **스토리북**: 핵심 UI 컴포넌트 개발 및 회귀 테스트 용도

## 실행 방법
```bash
npm install
npm run dev
```

`http://localhost:3000` 접속 후 게임을 시작할 수 있습니다. `npm run storybook`으로 UI 컴포넌트를 개별 확인할 수 있습니다.

---

## 게임 플레이 흐름
1. **게임 설정**
   - 플레이어 수 (2~4명)와 초기/최대 손패를 지정합니다.
   - 조커 포함 여부와 AI 난이도(이지/미디엄/하드)를 선택합니다.
   - 현재는 싱글 플레이만 지원하며, 멀티플레이는 추후 업데이트 예정입니다.

2. **게임 시작**
   - 선택된 설정대로 덱이 생성·셔플되고, 각 플레이어에게 초기 손패가 배분됩니다.
   - 첫 번째 플레이어(사용자)가 선 플레이어가 됩니다.

3. **턴 진행**
   - 플레이어는 손패에서 유효한 카드를 드래그 앤 드롭으로 낼 수 있습니다.
   - 낸 카드가 공격 혹은 특수 카드라면 즉시 효과가 적용됩니다.
   - 카드를 낼 수 없거나, 전략적으로 카드를 뽑고 싶다면 덱을 클릭해 드로우합니다.
- 드로우는 손패 최대치(`maxHandSize`)를 넘지 않는 선에서만 이뤄집니다.
- 피해가 누적된 상태에서 전부 상쇄하지 못하고 일부만 드로우해도, 현재 버전에서는 남은 피해가 그대로 사라집니다. (향후 보완 예정)
   - 턴 종료 후 시계/반시계 방향으로 다음 플레이어에게 진행됩니다.

4. **승리 조건**
   - 손패를 먼저 0장으로 만든 플레이어가 즉시 승리합니다.
   - 승자가 결정되면 게임 상태는 `finished`가 되고 리스타트 버튼으로 재시작할 수 있습니다.

---

## 카드 규칙 상세

### 기본 규칙
- **플레이 조건**: 현재 버려진 카드와 같은 숫자이거나 같은 무늬인 카드를 낼 수 있습니다.
- **조커**: 언제든 낼 수 있으며, 강력한 공격 카드로 취급됩니다.
- **드로우 제한**: 손패가 최대치(`maxHandSize`)에 도달하면 새 카드를 뽑을 수 없습니다.
- **블로킹 규칙(Damage 상황)**:
  - 마지막에 놓인 카드가 공격 카드(2, A, 조커)라면 누적 피해만큼 카드를 뽑아야 합니다.
  - 단, 특정 카드로 공격을 상쇄하거나 이동시킬 수 있습니다 (아래 참조).

### 공격 카드
| 카드 | 효과 |
|------|------|
| 2    | 다음 플레이어에게 카드 2장 드로우 누적 |
| A (1)| 다음 플레이어에게 카드 5장 드로우 누적 (같은 무늬의 1로만 방어 가능) |
| 조커 | 다음 플레이어에게 카드 7장 드로우 누적 (다른 조커로만 방어 가능) |

누적된 피해만큼 카드를 모두 뽑을 수 있을 때까지만 피해가 남습니다. 예를 들어 조커(7) 다음에 2를 내면 피해는 9로 누적됩니다.

### 특수 동작 카드
| 카드 | 효과 |
|------|------|
| J (11) | 다음 플레이어 턴을 건너뜀 (Skip) |
| Q (12) | 진행 방향을 반전 (시계 ↔ 반시계) |
| K (13) | 역순으로 턴 이동 (현재 방향 반대로 직전 플레이어 턴) |

특수카드의 효과는 즉시 적용되며, 다른 효과와 중첩될 수 있습니다. 예를 들어 J를 낸 직후 Q를 내면 건너뛰기 후 방향 전환이 일어납니다.

### 유효 카드 판단 로직
- 조커는 항상 유효합니다.
- 피해가 누적된 상태에서는 상쇄 가능한 카드(동일 숫자 혹은 특정 조건을 충족하는 카드)만 낼 수 있습니다.
- 상쇄 카드가 없다면 누적 피해만큼 드로우해야 하며, 드로우 완료 후 피해가 초기화됩니다.

---

## AI 동작 원리
- 현재는 **easy 난이도만 구현**돼 있으며, 단순 탐색 기반으로 동작합니다.
- AI는 손패에서 유효한 카드를 순서대로 찾아 가장 먼저 낼 수 있는 카드를 즉시 플레이합니다.
- 유효 카드가 없다면 누적 피해 수치에 맞춰 카드를 뽑습니다.
- 난이도 옵션(`medium`, `hard`)은 UI에서 설정만 가능하며, 추가 전략은 아직 미구현 상태입니다.

---

## 폴더 구조 요약
- `app/` — Next.js App Router 페이지. `game/single-player/page.tsx`가 게임 화면 전체를 구성합니다.
- `components/` — UI 컴포넌트와 게임 오브젝트(카드, 배지 등)를 포함합니다.
- `lib/hooks/useOneCardGame.ts` — 게임 전체 상태와 행위를 관리하는 커스텀 훅.
- `lib/state/` — 상태 전이를 담당하는 reducer 세부 로직.
- `lib/utils/cardUtils.ts` — 덱 생성, 셔플, 유효성 검사, 공격값 계산 등 카드 관련 유틸.
- `stories/` — Storybook 컴포넌트 문서화.

---

## 향후 개선 아이디어
- 멀티플레이 모드 및 네트워크 동기화
- AI 전략 고도화 (난이도별 행동 패턴)
- 공격 상쇄 실패 시 남은 피해 지속 관리 등 상세 규칙 보강
- 모바일 터치 드래그 UX 개선 및 접근성 강화
